@page "/obituary/{id:int}"
@inject HttpClient Http
@using ObituaryBlazorWasm.Models

<PageTitle>Obituary Details</PageTitle>

@if (obituary == null)
{
    <p><em>Loading obituary details...</em></p>
}
else
{
    <div class="obituary-detail">
        <h2>@obituary.FullName</h2>

        @if (obituary.Photo != null && obituary.Photo.Length > 0)
        {
            <img src="data:image/jpeg;base64,@obituary.Photo" alt="@obituary.FullName" class="obituary-photo" />
        }
        else
        {
            <img src="images/default-avatar.png" alt="No photo" class="obituary-photo" />
        }

        <p><strong>Born:</strong> @obituary.DateOfBirth.ToString("MMMM dd, yyyy")</p>
        <p><strong>Died:</strong> @obituary.DateOfDeath.ToString("MMMM dd, yyyy")</p>
        <p>@obituary.Biography</p>

        <a href="/">← Back to list</a>
    </div>
}

@code {
    [Parameter]
    public int id { get; set; }

    private Obituary? obituary;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            obituary = await Http.GetFromJsonAsync<Obituary>($"/api/obituaries/{id}");
        }
        catch (Exception ex)
        {
            Console.Error.WriteLine($"Error fetching obituary {id}: {ex.Message}");
        }
    }
}
