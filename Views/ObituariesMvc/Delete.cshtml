@* This view allows users to delete an existing obituary. *@

@model ObivtuaryMvcApi.Models.ObituaryDeleteViewModel
@{
    ViewData["Title"] = "Delete Obituary";
    var fullName = Model?.Obituary?.FullName ?? "this memorial";
}

<!-- Header -->
<section class="memorial-hero--sub" aria-labelledby="page-title">
    <div class="container">
        <div class="hero-inner">
            <i class="bi bi-exclamation-octagon" aria-hidden="true"></i>
            <h1 id="page-title" class="hero-title">Delete Memorial</h1>
            <p class="hero-subtitle">This action is permanent. Please review carefully before proceeding.</p>
        </div>
    </div>
</section>

<div class="container my-4">

    <!-- Second header shows user role (admin or regular user) -->
    @if (User.IsInRole("Admin"))
    {
        <div class="alert alert-info d-flex align-items-start gap-2" role="status">
            <i class="bi bi-shield-lock" aria-hidden="true"></i>
            <div>
                <strong>Administrator privileges.</strong> You can delete any obituary.
            </div>
        </div>
    }
    else if (Model?.CanDelete == true) 
    {
        <div class="alert alert-success d-flex align-items-start gap-2" role="status">
            <i class="bi bi-check2-circle" aria-hidden="true"></i>
            <div>
                <strong>Owner confirmed.</strong> You created this obituary and may delete it.
            </div>
        </div>
    }
    @* Third case: user is neither admin nor owner *@
    else
    {
        <div class="alert alert-danger d-flex align-items-start gap-2" role="status">
            <i class="bi bi-x-octagon" aria-hidden="true"></i>
            <div>
                <strong>Access denied.</strong> You do not have permission to delete this obituary.
            </div>
        </div>
    }

    <!-- Detailed obituary card -->
    <div class="card memorial-form-card">

        <div class="card-header d-flex align-items-center justify-content-between">
            <h5 class="mb-0"><i class="bi bi-journal-heart" aria-hidden="true"></i> Memorial Details</h5>
            <small class="text-muted">Please review before deletion</small>
        </div>

        <div class="card-body p-4">
            <div class="row g-4 align-items-start">
                <div class="col-md-4">

                    @* Photo *@
                    <div class="memorial-photo">
                        @if (Model?.Obituary.Photo != null)
                        {
                            <img src="data:image/jpeg;base64,@Convert.ToBase64String(Model.Obituary.Photo)"
                                 alt="Photo of @fullName"
                                 class="img-fluid rounded shadow-sm" />
                        }
                        else
                        {
                            <div class="photo-placeholder">
                                <i class="bi bi-person-heart" aria-hidden="true"></i>
                            </div>
                        }
                    </div>
                </div>
                <div class="col-md-8">

                    @* Name, dates, bio *@
                    <h3 class="memorial-name">@fullName</h3>
                    <p class="memorial-dates">
                        <i class="bi bi-calendar-heart" aria-hidden="true"></i>
                        @Model?.Obituary.DateOfBirth.ToString("MMMM d, yyyy")
                        <span class="sep">—</span>
                        @Model?.Obituary.DateOfDeath.ToString("MMMM d, yyyy")
                    </p>

                    <div class="memorial-bio">
                        @{
                            var bio = Model?.Obituary.Biography ?? "";
                            var longBio = bio.Length > 600;
                            var preview = longBio ? bio.Substring(0, 600) + "…" : bio;
                        }
                        <p class="mb-2">@preview</p>
                        @* The old "Read full biography" toggle and hidden fullBio were part of the popup UX; removed *@
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Delete action -->
    <div class="d-flex flex-wrap gap-2 mt-4">
        @if ((Model?.CanDelete == true) || User.IsInRole("Admin"))
        {
            <form asp-action="Delete" method="post" class="m-0" id="deleteForm">
                @Html.AntiForgeryToken()
                <input type="hidden" asp-for="Obituary.Id" />
                <button type="submit" class="btn btn-danger">
                    <i class="bi bi-trash"></i> Permanently Delete
                </button>
            </form>
        }
        @* Third case: user is neither admin nor owner *@
        else
        {
            <button type="button" class="btn btn-danger" disabled title="You do not have permission">
                <i class="bi bi-trash"></i> Permanently Delete
            </button>
        }

        @* go back button *@
        <a asp-action="Index" asp-controller="ObituariesMvc" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Back to Memorials
        </a>
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/memorial-delete.css" asp-append-version="true" />
}
